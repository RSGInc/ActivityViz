<html>
  <head>
    <title></title>
    <meta charset="UTF-8" />
    <script src="../bower_components/jquery/dist/jquery.min.js"></script>
    <script defer src="../bower_components/jqueryui/jquery-ui.min.js"></script>
    <script defer src="../bower_components/spectrum/spectrum.js"></script>
    <script src="../bower_components/chosen/chosen.jquery.js"></script>
    <script
      defer
      src="../bower_components/bootstrap/dist/js/bootstrap.min.js"
    ></script>
    <script
      defer
      src="../bower_components/datatables/datatables.min.js"
    ></script>
    <script src="../bower_components/d3/d3.js"></script>
    <script src="../bower_components/d3/d3-tip.js"></script>

    <script src="../bower_components/nvd3/build/nv.d3.js"></script>
    <script src="../bower_components/underscore/underscore-min.js"></script>
    <script src="../bower_components/geostats/lib/geostats.js"></script>
    <script
      type="text/javascript"
      src="https://stamen-maps.a.ssl.fastly.net/js/tile.stamen.js"
    ></script>
    <script src="../vendor/leaflet/leaflet-src.js"></script>
    <script src="../vendor/leaflet/leaflet.groupedlayercontrol.min.js"></script>
    <script src="../vendor/three.min.js"></script>
    <script src="../vendor/TweenMax.min.js"></script>
    <script src="../vendor/vizicities.js"></script>
    <script src="../vendor/d3-legend.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="../abmviz_utilities.js"></script>
    <script
      defer
      type="text/javascript"
      src="../bower_components/bootstrap/js/bootstrap-multiselect.js"
    ></script>
    <script type="text/javascript" src="grouped_barchart.js"></script>
    <script type="text/javascript" src="timeuse.js"></script>
    <script type="text/javascript" src="sunburst.js"></script>
    <script type="text/javascript" src="scatter.js"></script>
    <script type="text/javascript" src="chord.js"></script>
    <script type="text/javascript" src="barchart_and_map.js"></script>
    <script type="text/javascript" src="points_of_interest_map.js"></script>
    <script type="text/javascript" src="radar.js"></script>
    <script type="text/javascript" src="three3d.js "></script>

    <script defer type="text/javascript" src="mapper.js"></script>

    <script type="text/javascript" src="grouped_barchart_data.js"></script>

    <script type="text/javascript" src="radar-chart-nbremer.js"></script>

    <link rel="shortcut icon" href="" />
    <link
      rel="stylesheet"
      href="../bower_components/datatables/datatables.min.css"
    />
    <link
      rel="stylesheet"
      href="../bower_components/bootstrap/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="../bower_components/bootstrap/dist/css/bootstrap-multiselect.css"
    />
    <link rel="stylesheet" href="../bower_components/spectrum/spectrum.css" />
    <link
      rel="stylesheet"
      href="../bower_components/jqueryui/themes/base/jquery-ui.min.css"
    />
    <link rel="stylesheet" href="../bower_components/chosen/chosen.css" />
    <link
      rel="stylesheet"
      href="../bower_components/nvd3/build/nv.d3.min.css"
    />
    <link
      rel="stylesheet"
      href="../bower_components/geostats/lib/geostats.css"
    />
    <link
      rel="stylesheet"
      href="../bower_components/font-awesome/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="../vendor/leaflet/leaflet.groupedlayercontrol.min.css"
    />
    <link rel="stylesheet" href="../vendor/leaflet/leaflet.css" />
    <link rel="stylesheet" href="../vendor/vizicities.css" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="grouped_barchart.css" />
    <link rel="stylesheet" href="points_of_interest_map.css" />
    <link rel="stylesheet" href="barchart_and_map.css" />
    <link rel="stylesheet" href="sunburst.css" />
    <link rel="stylesheet" href="timeuse.css" />
    <link rel="stylesheet" href="three3d.css" />
    <link rel="stylesheet" href="radar.css" />
    <link rel="stylesheet" href="chord.css" />
    <link rel="stylesheet" href="scatter.css" />
  </head>
  <!-- end head -->

  <body>
    <div class="container-fluid" id="main_div">
      <br />
      <nav
        class="navbar navbar-inverse navbar-fixed-top"
        style="max-height:51px;"
      >
        <div class="navbar-header">
          <a
            id="navbarlink"
            href=""
            style="padding-left:1em;padding-top:1.1em;margin-right:-.5em;"
            class="pull-left"
          >
            <img id="logo_id" style="height:25px;" width="" height="" src="" />
          </a>
          <a class="navbar-brand" id="title_id" href="../index.html">ActivityViz</a>
          <span
            id="scenario-header"
            style="font-size:2em;cursor:default"
            class="navbar-brand pull-right"
          ></span>
        </div>
        <ul class="nav navbar-nav navbar-right" style="margin-right:1em;">
          <li class="nav-item">
            <a href="../index.html">Home</a>
          </li>
        </ul>
      </nav>
      <!-- end nav -->

      <div id="thenavbar">
        <ul class="nav nav-tabs" role="tablist" id="the_tabs">
          <li>
            <button id="leftnavbtn">
              <span class="glyphicon glyphicon-chevron-left"></span>
            </button>
            <button id="rightnavbtn">
              <span class="glyphicon glyphicon-chevron-right"></span>
            </button>
          </li>
        </ul>
      </div>
      <div></div>

      <main class="container-fluid row">
        <div class="explanation-panels col-xs-2 none"></div>
        <div class="tab-content col-xs-10"></div>
      </main>
      <!-- END TAB CONTENT-->
    </div>
    <!-- END MAIN CONTENT-->
  </body>
  <!-- end body -->
  <div class="footer">
    <div
      class="container"
      display="inline"
      style="position:relative; padding:5px 0px 5px 0px"
    >
      <span style="color:#9D9D9D; text-align:left"
        ><i class="far fa-copyright" aria-hidden="true"></i> RSG
      </span>
      <span style="position:absolute;right:0;text-align:right"
        ><a
          href="https://github.com/rsginc/ActivityViz"
          style="color:#9D9D9D"
          target="_blank"
          ><i class="fab fa-github-alt" aria-hidden="true"></i> Source Code</a
        ></span
      >
    </div>
  </div>
</html>

<script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
<script type="text/javascript">
  /**
   * The DataTable jQuery plugin logs errors by opening alert dialogs.
   * It's better UX and more effective for the developer to log those messages
   * to the console and provide a stacktrace.
   */
  window.alert = function(message) {
    console.error(message);
  };

  $(document).ready(function() {
    var shownTabs = $('li[role="presentation"]').children(":visible");
    if (shownTabs.length > 0) {
    }
    //shownTabs[0].click();
  });
</script>

<script type="text/javascript">
  var scenario = abmviz_utilities.GetURLParameter("scenario");
  var region = abmviz_utilities.GetURLParameter("region");
  $.ajaxSetup({
    cache: true
  });
  var dataLocation = localStorage.getItem(region);
  $.getJSON(dataLocation + "region.json", function(data) {
    var icon = data.Icon;
    var logo = data.Logo;
    var title = data.Title;
    var linkURL = data.LinkURL;
    var navbartitle = data.NavbarTitle;
    var tabbedCharts = data.TabbedCharts;
    $("link[rel*='icon']").attr("href", dataLocation + "img/" + icon + "");
    $("title").text(title);
    $("#title_id").text(navbartitle);
    $("#navbarlink").attr("href", linkURL);
    $("#logo_id").attr("src", dataLocation + "img/" + logo + "");

    var label = abmviz_utilities.GetURLParameter("scenario");

    if ("title" in data.scenarios[scenario]) {
      label = data.scenarios[scenario].title;
    } else if ("label" in data.scenarios[scenario]) {
      label = data.scenarios[scenario].label;
    }

    $("#scenario-header").html(label);
    $.each(data.colorRamps, function(key, value) {
      if (value == false) $("." + [key]).remove();
    });

    var visuals = data["scenarios"][scenario].visualizations;

    if (!visuals) return;

    // All tabs must be added before first one is clicked.
    // We'll use an array of promises to track when they are all complete.
    const tabAddPromises = [];

    $.each(visuals, function(key, value) {
      const tabAddFunctions = {
        GroupedCharts: addGroupedChartTab,
        TimeUse: addTimeUseTab,
        Sunburst: addSunburst,
        Scatter: addScatterTab,
        Chord: addChordTab,
        POIMap: addPointsOfInterestTab,
        RadarCharts: addRadarChartsTab,
        "3DMap": add3DMapTab,
        BarMap: addBarMapTab
      };

      for (let k in value) {
        const v = value[k];
        // Execute the function and store the promise in the array
        tabAddPromises.push(tabAddFunctions[key](k, v));
      }

      function addGroupedChartTab(k, v) {
        return addMyTab(
          "barchart.html",
          "BarChartGrp.barchart",
          v.name,
          k,
          "bc_" + v.name.replace(/\s/g, ""),
          v.explanation,
          function() {
            var chartname = "bc_" + v.name.replace(/\s/g, "");
            $("#grouped_tab").attr("id", chartname + "_id");
            $("#grouped-barchart-div").attr("id", chartname + "-div");
            $("#grouped-barchart-pivot-axes").attr(
              "id",
              chartname + "-pivot-axes"
            );
            $("#grouped-barchart-toggle-percentage").attr(
              "id",
              chartname + "-toggle-percentage"
            );
            $("#grouped-barchart-toggle-horizontal").attr(
              "id",
              chartname + "-toggle-horizontal"
            );
            $("#grouped-barchart-toggle-stacked").attr(
              "id",
              chartname + "-toggle-stacked"
            );
            $("#grouped-barmain").attr("id", chartname + "-barmain");
            $("#grouped-bar-container").attr("id", chartname + "-container");
            $("#datatable-columns").attr(
              "id",
              chartname + "-datatable-columns"
            );
            $("#datatable-div").attr("id", chartname + "-datatable-div");
            $("#datatable-table").attr("id", chartname + "-datatable-table");
            $("#datatable-collapse").attr(
              "id",
              chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr(
              "data-target",
              "#" + chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr("id", chartname + "-collapsebtn");
            $("#" + chartname + "-div").show();
          }
        );
      }

      function addTimeUseTab(k, v) {
        return addMyTab(
          "timeuse.html",
          "TimeuseChart.timeuse",
          v.name,
          k,
          "tu_" + v.name.replace(/\s/g, ""),
          v.explanation,
          function() {
            var chartname = "tu_" + v.name.replace(/\s/g, "");
            $("#timeuse_tab").attr("id", chartname + "_id");
            $("#timeuse").attr("id", chartname + "-div");
            $(".timeuse-maingroup").attr("id", chartname + "-maingroup");
            $("#timeuse-sidebar").attr("id", chartname + "-sidebar");
            $("#timeuse-text-area").attr("id", chartname + "-text-area");
            $("#timeuse-legend").attr("id", chartname + "-legend");
            $("#timeuse-main").attr("id", chartname + "-main");
            $("#timeuse-chart").attr("id", chartname + "-chart");
            $("#datatable-div").attr("id", chartname + "-datatable-div");
            $("#datatable-columns").attr(
              "id",
              chartname + "-datatable-columns"
            );
            $("#datatable-table").attr("id", chartname + "-datatable-table");
            $("#datatable-collapse").attr(
              "id",
              chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr(
              "data-target",
              "#" + chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr("id", chartname + "-collapsebtn");
            $("#" + chartname + "-div").show();
          }
        );
      }

      function addSunburst(k, v) {
        return addMyTab(
          "sunburst.html",
          "SunburstChart.sunburst",
          v.name,
          k,
          "sb_" + v.name.replace(/\s/g, ""),
          v.explanation,
          function() {
            var chartname = "sb_" + v.name.replace(/\s/g, "");
            $("#sunburst_tab").attr("id", chartname + "_id");
            $("#sunburst").attr("id", chartname + "-div");
            $("#sunburst-legend").attr("id", chartname + "-legend");
            $("#sunburst-chart").attr("id", chartname + "-chart");
            $("#sunburst-text-area").attr("id", chartname + "-text-area");
            $("#sunburst-explanation").attr("id", chartname + "-explanation");
            $("#sunburst-percentage").attr("id", chartname + "-percentage");
            $("#sunburst-current-node").attr("id", chartname + "-current-node");
            $("#sunburst-current-node-value").attr(
              "id",
              chartname + "-current-node-value"
            );
            $("#datatable-columns").attr(
              "id",
              chartname + "-datatable-columns"
            );
            $("#datatable-div").attr("id", chartname + "-datatable-div");
            $("#datatable-table").attr("id", chartname + "-datatable-table");
            $("#datatable-collapse").attr(
              "id",
              chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr(
              "data-target",
              "#" + chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr("id", chartname + "-collapsebtn");
            $("#" + chartname + "-div").show();
          }
        );
      }

      function addScatterTab(k, v) {
        return addMyTab(
          "scatter.html",
          "ScatterChart.scatter",
          v.name,
          k,
          "sc_" + v.name.replace(/\s/g, ""),
          v.explanation,
          function() {
            var chartname = "sc_" + v.name.replace(/\s/g, "");
            $("#scatter_tab").attr("id", chartname + "_id");
            $("#scatter").attr("id", chartname + "-div");
            $("#scatter-tooltip").attr("id", chartname + "-tooltip");
            $("#scatter-main").attr("id", chartname + "-main");
            $("#scatter-chart-container").attr(
              "id",
              chartname + "-chart-container"
            );
            $("#datatable-columns").attr(
              "id",
              chartname + "-datatable-columns"
            );
            $("#datatable-div").attr("id", chartname + "-datatable-div");
            $("#datatable-table").attr("id", chartname + "-datatable-table");
            $("#datatable-collapse").attr(
              "id",
              chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr(
              "data-target",
              "#" + chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr("id", chartname + "-collapsebtn");
            $("#" + chartname + "-div").show();
          }
        );
      }

      function addChordTab(k, v) {
        return addMyTab(
          "chord.html",
          "ChordChart.chord",
          v.name,
          k,
          "ch_" + v.name.replace(/\s/g, ""),
          v.explanation,
          function() {
            var chartname = "ch_" + v.name.replace(/\s/g, "");
            $("#chord_tab").attr("id", chartname + "_id");
            $("#chord").attr("id", chartname + "-div");
            $("#chord-tooltip").attr("id", chartname + "-tooltip");
            $("#chord-main").attr("id", chartname + "-main");
            $("#chord-dropdown-div").attr("id", chartname + "-dropdown-div");
            $("#chord-chart-container").attr(
              "id",
              chartname + "-chart-container"
            );
            $("#chord-chart-map").attr("id", chartname + "-chart-map");
            $("#chord-by-district-map").attr(
              "id",
              chartname + "-by-district-map"
            );
            $("#datatable-div").attr("id", chartname + "-datatable-div");
            $("#datatable-columns").attr(
              "id",
              chartname + "-datatable-columns"
            );
            $("#datatable-table").attr("id", chartname + "-datatable-table");
            $("#datatable-collapse").attr(
              "id",
              chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr(
              "data-target",
              "#" + chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr("id", chartname + "-collapsebtn");
            $("#" + chartname + "-div").show();
          }
        );
      }

      function addPointsOfInterestTab(k, v) {
        return addMyTab(
          "pointofinterest.html",
          "POIMap.pointofinterest_and_map",
          v.name,
          k,
          "poi_" + v.name.replace(/\s/g, ""),
          v.explanation,
          function() {
            var chartname = "poi_" + v.name.replace(/\s/g, "");
            $("#poimap_tab").attr("id", chartname + "_id");
            $("#poi-by-group").attr("id", chartname + "-div");
            $("#poi-by-group-stacked").attr("id", chartname + "-stacked");
            $("#poi-by-group-chart").attr("id", chartname + "-chart");
            $("#poi-by-group-values-current").attr(
              "id",
              chartname + "-values-current"
            );
            $("#poi-by-group-groups-current").attr(
              "id",
              chartname + "-groups-current"
            );
            $("#poi-by-group-tooltable").attr("id", chartname + "-tooltable");
            $("#poi-by-group-bubble-color").attr(
              "id",
              chartname + "-bubble-color"
            );
            $("#poi-by-group-bubble-size").attr(
              "id",
              chartname + "-bubble-size"
            );
            $("#poi-by-group-emptydiv").attr("id", chartname + "-emptydiv");
            $("#poi-by-group-map").attr("id", chartname + "-map");
            $("#poi-by-group-pallette").attr("id", chartname + "-pallette");
            $("#poi-by-group-filter-span").attr(
              "id",
              chartname + "-filter-span"
            );
            $("#datatable-div").attr("id", chartname + "-datatable-div");
            $("#datatable-columns").attr(
              "id",
              chartname + "-datatable-columns"
            );
            $("#datatable-table").attr("id", chartname + "-datatable-table");
            $("#datatable-collapse").attr(
              "id",
              chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr(
              "data-target",
              "#" + chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr("id", chartname + "-collapsebtn");
            $("#" + chartname + "-div").show();
          }
        );
      }

      function addRadarChartsTab(k, v) {
        return addMyTab(
          "radar.html",
          "RadarData.radar",
          v.name,
          k,
          "rc_" + v.name.replace(/\s/g, ""),
          v.explanation,
          function() {
            var chartname = "rc_" + v.name.replace(/\s/g, "");
            $("#radar_tab").attr("id", chartname + "_id");
            $("#radar").attr("id", chartname + "-div");
            $("#radar-main").attr("id", chartname + "-main");
            $("#radar-chart-container").attr(
              "id",
              chartname + "-chart-container"
            );
            $("#datatable-columns").attr(
              "id",
              chartname + "-datatable-columns"
            );
            $("#datatable-div").attr("id", chartname + "-datatable-div");
            $("#datatable-table").attr("id", chartname + "-datatable-table");
            $("#datatable-collapse").attr(
              "id",
              chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr(
              "data-target",
              "#" + chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr("id", chartname + "-collapsebtn");
            $("#" + chartname + "-div").show();
          }
        );
      }

      function add3DMapTab(k, v) {
        return addMyTab(
          "threed.html",
          "ThreeDMap.three3dFunction",
          v.name,
          k,
          "td_" + v.name.replace(/\s/g, ""),
          v.explanation,
          function() {
            var chartname = "td_" + v.name.replace(/\s/g, "");
            $("#three3d_tab").attr("id", chartname + "_id");
            $("#three3d").attr("id", chartname + "-div");
            $("#three3d-current-period").attr(
              "id",
              chartname + "-current-period"
            );
            $("#three3d-controls").attr("id", chartname + "-controls");
            $("#three3d-centroids").attr("id", chartname + "-centroids");
            $("#three3d-classification-label").attr(
              "id",
              chartname + "-classification-label"
            );
            $("#three3d-classification").attr(
              "id",
              chartname + "-classification"
            );
            $("#three3d-period-id").attr("id", chartname + "-period-id");
            $("#three3d-period-label").attr("id", chartname + "-period-label");
            $("#three3d-period").attr("id", chartname + "-period");
            $("#three3d-map").attr("id", chartname + "-map");
            $("#opacityRange").attr("id", chartname + "-opacityRange");
            $("#opacityval").attr("id", chartname + "-opacityval");
            $("#three3d-naColor").attr("id", chartname + "-naColor");
            $("#three3d-slider").attr("id", chartname + "-slider");
            $("#three3d-slider-time").attr("id", chartname + "-slider-time");
            $("#three3d-update-map").attr("id", chartname + "-update-map");
            $("#three3d-start-cycle-map").attr(
              "id",
              chartname + "-start-cycle-map"
            );
            $("#three3d-stop-cycle-map").attr(
              "id",
              chartname + "-stop-cycle-map"
            );
            $("#three3d-redraw").attr("id", chartname + "-redraw");
            $("#three3d-cycle-frequency").attr(
              "id",
              chartname + "-cycle-frequency"
            );
            $("#datatable-columns").attr(
              "id",
              chartname + "-datatable-columns"
            );
            $("#datatable-div").attr("id", chartname + "-datatable-div");
            $("#datatable-table").attr("id", chartname + "-datatable-table");
            $("#datatable-collapse").attr(
              "id",
              chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr(
              "data-target",
              "#" + chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr("id", chartname + "-collapsebtn");
            $("#" + chartname + "-div").show();
          }
        );
      }

      function addBarMapTab(k, v) {
        return addMyTab(
          "barchartmap.html",
          "BarChartMap.barchart_and_map",
          v.name,
          k,
          "bm_" + v.name.replace(/\s/g, ""),
          v.explanation,
          function() {
            var chartname = "bm_" + v.name.replace(/\s/g, "");
            $("#barchartmap_tab").attr("id", chartname + "_id");
            $("#mode-share-by-county").attr("id", chartname + "-div");
            $("#mode-share-by-county-stacked").attr(
              "id",
              chartname + "-stacked"
            );
            $("#mode-share-by-county-chart").attr("id", chartname + "-chart");
            $("#mode-share-by-county-classification-label").attr(
              "id",
              chartname + "-classification-label"
            );
            $("#mode-share-by-county-current-trip-mode-zones").attr(
              "id",
              chartname + "-current-trip-mode-zones"
            );
            $("#mode-share-by-county-current-trip-mode-bubbles").attr(
              "id",
              chartname + "-current-trip-mode-bubbles"
            );
            $("#mode-share-by-county-classification").attr(
              "id",
              chartname + "-classification"
            );
            $("#mode-share-by-county-checkboxes").attr(
              "id",
              chartname + "-checkboxes"
            );
            $("#mode-share-by-county-map").attr("id", chartname + "-map");
            $("#mode-share-by-county-pallette").attr(
              "id",
              chartname + "-pallette"
            );
            $("#mode-share-by-county-tools").attr("id", chartname + "-tools");
            $("#mode-share-by-county-zones").attr("id", chartname + "-zones");
            $("#mode-share-by-county-bubbles").attr(
              "id",
              chartname + "-bubbles"
            );
            $("#mode-share-by-county-bubble-color").attr(
              "id",
              chartname + "-bubble-color"
            );
            $("#mode-share-by-county-bubble-size").attr(
              "id",
              chartname + "-bubble-size"
            );
            $("#mode-share-by-county-stroke").attr("id", chartname + "-stroke");
            $("#mode-share-by-county-naColor").attr(
              "id",
              chartname + "-naColor"
            );
            $("#mode-share-by-county-slider").attr("id", chartname + "-slider");
            $("#mode-share-by-county-update-map").attr(
              "id",
              chartname + "-update-map"
            );
            $("#mode-share-by-county-start-cycle-map").attr(
              "id",
              chartname + "-start-cycle-map"
            );
            $("#mode-share-by-county-stop-cycle-map").attr(
              "id",
              chartname + "-stop-cycle-map"
            );
            $("#mode-share-by-county-cycle-frequency").attr(
              "id",
              chartname + "-cycle-frequency"
            );
            $("#datatable-columns").attr(
              "id",
              chartname + "-datatable-columns"
            );
            $("#datatable-div").attr("id", chartname + "-datatable-div");
            $("#datatable-table").attr("id", chartname + "-datatable-table");
            $("#datatable-collapse").attr(
              "id",
              chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr(
              "data-target",
              "#" + chartname + "-datatable-collapse"
            );
            $("#collapsebtn").attr("id", chartname + "-collapsebtn");
            $("#" + chartname + "-div").show();
          }
        );
      }
    });

    Promise.all(tabAddPromises).then(function() {
      $('li[role="presentation"] a')[0].click();
    });
  });

  function addMyTab(
    filename,
    chartype,
    name,
    indx,
    idname,
    explanation,
    callback
  ) {
    return new Promise(function(resolve, reject) {
      var newEl = $(
        "<li role='presentation'><a href='#" +
          idname +
          "_id' role='tab' data-toggle='tab' onclick='" +
          chartype +
          '("' +
          idname +
          '",' +
          indx +
          ")' >" +
          name +
          "</a></li>"
      );

      var theTabs = $("#the_tabs");
      // hack to put the tabs in the correct order, with the buttons at the end
      theTabs.append(newEl); // without this line, tabs are in opposite order
      theTabs.append($("#leftnavbtn")); // without these two lines, buttons will be at beginning
      theTabs.append($("#rightnavbtn"));

      var nativeEl = newEl[0]; // get the native DOM element
      nativeEl.addEventListener("click", function() {
        updateExplanationPanel(explanation);
      });

      $.get("templates/" + filename, function(data) {
        $(".tab-content").append(data);
      }).complete(function(d) {
        callback();
        resolve();
      });
    });
  }

  $("#leftnavbtn").click(function(d) {
    var shownTabs = $('li[role="presentation"]').children(":visible");
    var i = 0;
    var activeIdx = 0;
    $.each(shownTabs, function(d) {
      if (
        $(this)
          .closest("li")
          .hasClass("active")
      ) {
        activeIdx = i;
      }
      i++;
    });
    var nextIdx = activeIdx - 1 < 0 ? shownTabs.length - 1 : activeIdx - 1;
    shownTabs[nextIdx].click();
  });

  $("#rightnavbtn").click(function(d) {
    var shownTabs = $('li[role="presentation"]').children(":visible");
    var i = 0;
    var activeIdx = 0;
    $.each(shownTabs, function(d) {
      if (
        $(this)
          .closest("li")
          .hasClass("active")
      ) {
        activeIdx = i;
        return;
      }
      i++;
    });
    var nextIdx = activeIdx + 1 >= shownTabs.length ? 0 : activeIdx + 1;
    shownTabs[nextIdx].click();
  });

  function updateExplanationPanel(explanation) {
    var explanationPanels = document.querySelector(".explanation-panels");
    var tabContent = document.querySelector(".tab-content");
    explanationPanels.innerHTML = "";

    if (!explanation) {
      explanationPanels.classList.add("none");
      tabContent.classList.remove("col-xs-10");
      tabContent.classList.remove("pl-2");
      tabContent.classList.add("col-xs-12");
      return;
    }

    explanationPanels.classList.remove("none");
    tabContent.classList.remove("col-xs-12");
    tabContent.classList.add("col-xs-10");
    tabContent.classList.add("pl-2");

    for (var section of explanation) {
      var panel = document.createElement("article");
      panel.classList.add("panel");
      panel.classList.add("panel-dark");
      explanationPanels.appendChild(panel);

      var sectionHeader = document.createElement("header");
      sectionHeader.classList.add("panel-header");
      sectionHeader.classList.add("panel-heading");
      panel.appendChild(sectionHeader);

      var sectionTitle = document.createElement("h3");
      sectionTitle.classList.add("panel-title");
      sectionTitle.innerText = section.header;
      sectionHeader.appendChild(sectionTitle);

      var panelBody = document.createElement("div");
      panelBody.classList.add("panel-body");
      panel.appendChild(panelBody);

      for (let contentList of section.body) {
        panelBody.appendChild(getContentList(contentList));
      }
    }

    function getContentList(subsection) {
      switch (subsection.type) {
        case "orderedList":
          return nestedElementsFromStringArray("ol", "li", subsection.content);

        case "unorderedList":
          return nestedElementsFromStringArray("ul", "li", subsection.content);

        default:
          return nestedElementsFromStringArray(
            "section",
            "p",
            subsection.content
          );
      }
    }

    function nestedElementsFromStringArray(
      containerTag,
      listItemTag,
      stringContentArray
    ) {
      var containerElement = document.createElement(containerTag);
      for (var stringContent of stringContentArray) {
        var listItem = document.createElement(listItemTag);
        listItem.innerHTML = stringContent;
        containerElement.appendChild(listItem);
      }
      return containerElement;
    }
  }
</script>
